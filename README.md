# SportWkT テスト用機能ガイド

マルチテナント対応のスポーツクラブ・体操教室管理SaaSプラットフォーム

---

## 目次

1. [概要](#1-概要)
2. [認証機能](#2-認証機能)
3. [保護者（Guardian）機能](#3-保護者guardian機能)
4. [コーチ（Coach）機能](#4-コーチcoach機能)
5. [管理者（Admin）機能](#5-管理者admin機能)
6. [会員タイプとフロー](#6-会員タイプとフロー)
7. [テストアカウント](#7-テストアカウント)
8. [利用者ガイド](#8-利用者ガイド)
9. [よくある質問（FAQ）](#9-よくある質問faq)

---

## 1. 概要

### アプリの目的

SportWkTは、体操教室やスポーツクラブの運営を効率化するための管理プラットフォームです。

**主な機能:**
- クラススケジュール管理・予約システム
- 出欠確認と出席率管理
- 指導日記（活動記録）の作成・共有
- 級・段位の進捗管理と昇級試験
- 保護者・生徒・コーチ・管理者の役割分担
- チケット制と月謝制の両対応
- リアルタイム通知とお知らせ配信

### 対象ユーザー

| ロール | 説明 |
|--------|------|
| **保護者（Guardian）** | 子供のスケジュール管理、成長確認、予約・キャンセル |
| **コーチ（Coach）** | クラス運営、出欠確認、指導日記作成、昇級試験実施 |
| **管理者（Admin）** | システム全体の管理、マスタデータ管理、設定 |

### 利用シーン

- 体操教室: 階級管理、技能進捗追跡、動画・写真での成長記録
- サッカークラブ: 出欠管理、チーム編成、試合結果記録
- スイミングスクール: レベル別クラス管理、進級テスト記録

---

## 2. 認証機能

### 2.1 スプラッシュ画面

**機能:**
- アプリ起動時の初期画面
- 自動ログインチェック
- セッション有効期限確認（90日）
- 端末変更検出
- ロール別画面への自動遷移

**自動ログイン結果:**
- `allowed` - 自動ログイン可能、ホーム画面へ遷移
- `expired` - セッション期限切れ（90日以上未使用）、ログイン画面へ
- `deviceChanged` - 端末変更検出、ログイン画面へ
- `notLoggedIn` - 未ログイン、ログイン画面へ

### 2.2 ログイン画面

**機能:**
- メールアドレス・パスワード認証
- パスワード表示/非表示切り替え
- バリデーション（メール形式、パスワード6文字以上）
- パスワードリセット機能
- ログイン後のロール判定と画面遷移
- 承認ステータスに応じた画面遷移
  - `pending` - 承認待ち画面へ
  - `rejected` - 却下画面へ
  - `approved` - ロール別ホーム画面へ

**入力フィールド:**
- メールアドレス（必須、形式チェック）
- パスワード（必須、6文字以上）

**ボタン:**
- ログインボタン
- パスワードを忘れた場合（ダイアログ表示）
- 新規登録ボタン（サインアップ画面へ）

### 2.3 サインアップ画面

**機能:**
- 新規アカウント作成
- パスワード強度インジケーター（4段階）
  - 弱い（赤色） - 8文字未満または単純
  - 普通（オレンジ） - 8文字以上
  - 良い（ライトグリーン） - 12文字以上＋複数文字種
  - 強い（緑色） - 12文字以上＋大小英数記号
- パスワード確認入力

**入力フィールド:**
- メールアドレス（必須、形式チェック）
- パスワード（必須、6文字以上）
- パスワード確認（必須、一致チェック）

**パスワード強度判定:**
- 長さ（8文字以上、12文字以上）
- 小文字含む
- 大文字含む
- 数字含む
- 記号含む

### 2.4 オンボーディングフロー（保護者向け）

**3ステップウィザード:**

**Step 1: 招待コード入力**
- 組織の招待コード入力
- 組織・拠点情報の検証
- 検証成功後に次へ

**Step 2: 保護者・生徒情報入力**
- 保護者情報:
  - 保護者名（必須）
  - 電話番号（必須）
- 生徒情報:
  - 姓・名（必須）
  - セイ・メイ（必須）
  - ニックネーム（任意）
  - 生年月日（年・月・日ドロップダウン）
  - 学年（任意、生年月日から自動設定）
  - 性別（任意）
  - 血液型（任意）
- プラン選択:
  - 施設モード（FIXED/FREE）
  - プログラム選択
  - 料金プラン選択（回数・金額）
  - セッションパターン選択（固定プランの場合）

**Step 3: 利用規約同意**
- 利用規約への同意（必須）
- プライバシーポリシーへの同意（必須）
- ニュースレター購読（任意）
- 登録申請送信

**機能:**
- 生年月日から年齢を自動計算
- 年齢に基づくプログラムフィルタリング
- 学年と生年月日の整合性検証
- 承認待ち画面への遷移

### 2.5 承認待ち画面

**表示内容:**
- 承認待ちアイコン（砂時計、オレンジ）
- タイトル: 「登録申請を送信しました」
- 申請情報カード:
  - スクール名
  - 保護者名
  - 生徒名
  - 申請日時
- 説明文:
  - 管理者による承認待ち
  - 承認後にメール通知
  - 数日かかる場合がある旨
- リロードボタン（承認状態を再確認）
- ログアウトボタン

### 2.6 却下画面

**表示内容:**
- 却下アイコン（×マーク、赤色）
- タイトル: 「登録申請が承認されませんでした」
- 申請情報カード:
  - スクール名
  - 却下日時
  - 却下理由（管理者が入力した理由）
- 説明文:
  - スクールへのお問い合わせを推奨
  - サポートメールアドレス表示
- ログアウトボタン

### 2.7 コーチ招待コード入力画面

**機能:**
- 6桁の招待コード入力（大文字）
- 自動フォーカス移動
- 検証成功後に確認画面へ遷移

**入力フィールド:**
- 6個の1文字入力フィールド
- 大文字自動変換
- エラー時は赤枠表示

**ボタン:**
- 確認ボタン（6文字入力後に有効化）
- 閉じるボタン（ログアウト）

### 2.8 コーチ招待確認画面

**表示内容:**
- 組織情報（名前・住所）
- 拠点情報
- プログラム情報
- 確認メッセージ

**ボタン:**
- 承認ボタン - コーチアカウント作成
- キャンセルボタン - 前の画面へ戻る

### 2.9 認証フロー

```
ユーザーログイン
  ↓
Firebase Authentication
  ↓
組織ID + メンバーID 取得
  ↓
Member情報取得
  ↓
Member.type でロール判定
  ├─ guardian → /home （保護者画面）
  ├─ coach → /coach （コーチ画面）
  └─ admin → /admin （管理者画面）
```

---

## 3. 保護者（Guardian）機能

### 3.1 ホーム画面（フィード形式）

**表示内容:**
- フィード形式のタイムライン表示
  - お知らせ（通知）
  - 連絡帳
  - 活動の記録
  - 出欠連絡
  - アンケート
  - アルバム
  - 請求情報
  - 承認連絡
- フィルター機能（日付範囲、種別別）
- ブックマーク機能（お気に入り管理）
- 月次施設選択ステータスカード
- フィードアイテムの詳細表示（画像・動画対応）
- 施設切り替えドロワー（複数拠点利用時）

### 3.2 予約・スケジュール画面

**会員タイプ別の動作:**

| 会員タイプ | 動作 |
|-----------|------|
| FREE | 月間カレンダーから好きなクラスを選んで予約、チケット消費 |
| FIXED | 固定スケジュールが自動表示（青色）、振替可能 |

**セッションモード:**
- セッションには `mode` フィールドがあり、"FREE" | "FIXED" | "BOTH" のいずれかを設定
- mode="BOTH" のセッションは、フリー会員と固定会員の両方が予約可能（それぞれ別の定員枠で管理）
  - `fixedCapacity` / `fixedReservedCount` - 固定会員用の枠
  - `freeCapacity` / `freeReservedCount` - フリー会員用の枠

**機能:**
- 月間カレンダービュー
- 会員情報カード表示
- 生徒選択ドロップダウン（保護者の複数生徒対応）
- 拠点別予約管理
- 欠席連絡機能（理由テンプレート付き）
- 振替予約機能

### 3.3 活動記録（連絡帳）閲覧

**タブ構成:**
- 活動記録タブ
- マイコメントタブ

**表示内容:**
- 日付別の活動内容
- 写真・動画（スワイプで閲覧）
- コーチからのコメント
- タグ（例: 「マット運動」「跳び箱」）

### 3.4 出席記録

**タブ構成:**
- 出欠カレンダータブ
- 出欠記録一覧タブ

**表示内容:**
- カレンダービュー（出席日=緑、欠席日=赤）
- 出席履歴リスト
- 拠点別の出欠記録

**ステータス:** 出席(緑) / 欠席(赤) / 遅刻(黄) / 早退(オレンジ)

### 3.5 成長記録

**タブ構成:**
- グラフタブ（成長推移の可視化）
- 記録一覧タブ
- 評価タブ

**表示内容:**
- 成長記録のグラフ表示
- 記録一覧
- 評価情報

### 3.6 級・段位確認

**表示内容:**
- 現在のランクバッジ（種目別）
- 次のランクに必要な条件
- 進捗バー
- 過去の昇級履歴

### 3.7 お知らせ

**通知タイプ:** 一般 / 重要 / イベント / スケジュール変更

### 3.8 請求情報

**タブ構成:**
- 今月の請求書タブ
- 請求履歴タブ
- 支払い方法タブ

**機能:**
- 請求書の確認
- 過去の請求履歴閲覧
- 支払い方法の管理

### 3.9 その他メニュー

**ユーザー情報カード:**
- プロフィール画像・名前・メールアドレス表示
- ログアウトボタン

**グリッドメニュー:**
- 資料室（ドキュメント閲覧）
- 請求情報
- 家族の設定
- 施設の設定
- アプリの設定
- ヘルプ

**バージョン情報:**
- アプリバージョン、デバイス情報の表示

### 3.10 資料室

**機能:**
- 公開資料の一覧表示
- 未読/既読管理（NEWバッジ表示）
- 添付ファイル数の表示
- 資料の詳細閲覧

**詳細画面:**
- 資料タイトル・本文の表示
- 添付ファイルのダウンロード・閲覧
- 既読状態の自動更新

### 3.11 家族の設定

**機能:**
- 保護者一覧表示・管理
- お子さま一覧表示・管理
- 保護者招待機能
- お子さま追加機能
- 家族情報の編集

**保護者詳細画面:**
- 保護者の基本情報表示
- 連絡先情報の確認

**お子さま詳細画面:**
- お子さまの基本情報表示
- プログラム・契約情報の確認
- プロフィール編集

### 3.12 お子さま追加フロー

**3ステップウィザード:**

**Step 1: 基本情報入力**
- お名前（姓・名）
- フリガナ（セイ・メイ）
- ニックネーム（任意）
- 生年月日（年・月・日のドロップダウン）
- 学年（任意、生年月日から自動設定）
- 性別（任意）
- 血液型（任意）

**Step 2: プログラム選択**
- プランタイプ選択（FIXED/FREE）
- プログラム追加ボタン
- 複数プログラムの登録対応
- 各プログラムの詳細設定
  - 月間利用回数
  - 月額料金
  - セッションパターン（固定会員の場合）
  - メインプログラム設定

**Step 3: 確認**
- 入力内容の確認
- 利用規約への同意
- お子さまアカウントの作成

**機能:**
- 生年月日から学年を自動計算
- 学年と生年月日の整合性検証（警告表示）
- 対象年齢に基づくプログラムフィルタリング

### 3.13 施設の設定

**機能:**
- 利用中の施設一覧表示
- 施設詳細の確認
- 施設の追加・削除

**施設追加画面:**
- 組織コードによる施設追加
- 施設検索機能

**施設詳細画面:**
- 施設の基本情報表示
- 営業時間・連絡先の確認

### 3.14 アプリ設定

**機能:**
- 通知設定
  - プッシュ通知
  - メール通知
  - スケジュールリマインダー
  - 支払いリマインダー
- プライバシー設定
- 言語設定
- 利用規約表示
- プライバシーポリシー表示
- ログアウト

### 3.15 お問い合わせ

**機能:**
- サポートへの問い合わせフォーム
- 問い合わせ履歴の確認
- よくある質問（FAQ）へのリンク

### 3.16 プロフィール

**表示内容:**
- プロフィール画像
- 基本情報（生年月日、メール、電話）
- チーム情報（加入日）

**機能:**
- 通知設定
- プライバシー設定
- ヘルプ・サポート
- ログアウト

---

## 4. コーチ（Coach）機能

### 4.1 ホーム画面

**表示内容:**
- ウェルカムメッセージカード（時間帯に応じた挨拶）
- クイック統計表示
  - 今日のセッション数
  - 今週のセッション数
  - 承認待ちの出欠数
- 今日のスケジュール一覧（予約人数表示付き）
- 未承認の出欠一覧（承認/却下ボタン付き）
- プルリフレッシュ機能

### 4.2 メニュー画面

**ユーザー情報カード:**
- プロフィール画像
- 名前・メールアドレス表示
- コーチロールバッジ
- ログアウトボタン

**シフト・勤怠セクション:**
- シフト登録 - シフト登録画面へ遷移
- レッスンスケジュール - 担当セッション閲覧
- 勤怠管理 - 出退勤打刻

**設定セクション:**
- 通知設定
- ヘルプ
- 利用規約
- プライバシーポリシー

**バージョン情報:**
- アプリバージョン・デバイス情報の表示

### 4.3 出席管理

**クラス一覧画面:**

**機能:**
- 日付選択（カレンダー機能）
- 拠点選択（複数拠点対応）
- セッション/クラス一覧表示
- 各クラスの予約人数と定員表示

**出欠記録画面:**

**操作手順:**
1. 日付を選択
2. 担当クラスを選択
3. 予約済み生徒一覧が表示
4. 各生徒をタップして出欠を記録（出席/欠席/遅刻/早退）
5. メモ欄に特記事項を記入
6. 「保存」ボタンで確定

**一括操作:**
- 「全員出席」ボタン
- 「未確認のみ表示」フィルター

### 4.4 承認待ち出欠管理

**機能:**
- 保護者からの出欠リクエスト一覧
- 生徒ごとのリクエストステータス表示
- 一括承認ボタン
- 個別承認/却下機能（理由付き）

### 4.5 シフト登録

**機能:**
- カレンダーベースのシフト登録UI
- 月間シフト表示
- 複数日シフト（グループ化）と単日シフトの区別
- シフト提出機能
- 期限内の月のみ表示（自動フィルタリング）
- シフト状況の可視化（登録済み/未登録）
- カレンダー上にシフトカード数を表示（マーカー）
- シフト締切日の確認

**シフトタイプ:**
- 単日シフト - 特定の1日・1拠点の勤務
- 複数日シフト（グループ化） - 連続した複数日・複数拠点の勤務

**締切管理:**
- 当月シフト締切日
- 翌月シフト締切日
- 期限内の月のみ表示・編集可能

### 4.6 レッスンスケジュール

**機能:**
- コーチの月間担当セッション表示
- アサインメントタイプ表示（専属/ヘルプ等）
- カレンダービュー
- セッション情報の詳細表示

### 4.7 勤怠管理（タイムカード）

**機能:**
- 現在時刻表示（リアルタイム更新）
- 本日のシフト情報表示
  - 勤務予定拠点
  - 勤務予定時間
- GPS機能対応拠点の位置確認
  - GPS有効拠点の場合、位置情報取得
  - 勤務地との距離確認
- 出勤/退勤の打刻
  - 出勤時刻の記録
  - 退勤時刻の記録
  - GPS位置情報の記録（対応拠点のみ）
- 本日の勤務状態表示
  - 未出勤 / 出勤中 / 退勤済み
  - 勤務開始時刻・終了時刻
  - 勤務時間の計算表示

### 4.8 生徒管理

**機能:**
- 拠点別の生徒一覧表示
- クラスフィルター
- 曜日フィルター
- 生徒の出席率表示
- 生徒詳細情報シート
  - 基本情報（クラス、スケジュール、ステータス）
  - 成長記録ボタン
  - メッセージ送信ボタン
- 生徒追加FAB

### 4.9 コミュニケーション

**タブ構成:**
- お知らせタブ
- 活動記録タブ

**機能:**
- フィルター機能（検索、タイプ、期間）
- 拠点選択機能（複数拠点対応）
- お知らせ/活動記録の作成ボタン

### 4.10 活動記録作成

**入力項目:**
- テンプレート選択（練習/試合/イベント/その他）
- カテゴリ選択
- 対象選択（施設全体 / 特定クラス / 個別生徒）
- 日付・拠点選択
- タイトル・本文
- 写真アップロード（最大10枚、リサイズ・品質調整対応）
- 動画アップロード（最大3本、1分以内、50MB以下）

### 4.11 通知作成

**入力項目:**
- テンプレート機能（複数パターン）
- 通知タイプ（一般 / 重要 / 重大）
- 対象選択（全校 / 特定クラス / 個別メンバー）
- タイトル・本文
- 画像/動画添付（オプション）
- 配信設定（即時配信 / 予約配信）

### 4.12 昇級試験管理

**試験管理画面:**

**機能:**
- 日付選択
- 拠点選択（複数拠点対応）
- テスト一覧表示（クラス/セッション単位）

**クラステスト管理:**

**評価フロー:**
1. 受験者を選択
2. 評価項目をチェック（合格/不合格/要練習）
3. 写真・動画を撮影（証拠として）
4. フィードバックコメント入力
5. 総合判定 → 合格時はランク進捗を自動更新

### 4.13 統計

**表示内容:**
- 昇級試験統計の表示
- カテゴリ別成績表示（床運動、跳び箱、鉄棒、トランポリン等）
- 期間フィルター（開始日〜終了日）
- 合格率の計算と表示
- 科目別・レベル別の集計

**フィルター機能:**
- 日付範囲指定
- 拠点選択
- プログラム選択

---

## 5. 管理者（Admin）機能

### 5.1 ダッシュボード

**ウェルカムカード:**
- 管理者名の表示
- 時間帯に応じた挨拶メッセージ

**要対応セクション:**
- 承認待ちの登録申請件数（タップで申請一覧へ遷移）
- シフト未提出コーチ数（当月・翌月合算）
- 担当未設定レッスン数（当月・翌月合算、タップでレッスン担当設定画面へ）

**本日の状況:**
- 本日のレッスン件数
- 本日の予約数と占有率
- プログレスバー表示

**会員統計:**
- 在籍中の生徒数（承認済み）
- 休会中の生徒数
- 退会済みの生徒数
- アクティブコーチ数
- グラフ表示

**月別推移グラフ:**
- 過去6ヶ月の利用状況推移
- 予約数・出席数の推移

**曜日別利用状況グラフ:**
- 月〜日曜日別の利用状況
- 曜日ごとの平均利用率

**月次施設選択状況:**
- フレキシブルプラン会員の月次施設選択状況
- 拠点別の選択状況

**管理メニューセクション:**
- 主要機能へのクイックアクセスボタン

### 5.2 メンバー管理

**タブ構成:**
- 生徒タブ
- コーチタブ

**生徒タブの機能:**
- 生徒一覧表示
- サブタイトル表示: 在籍X名 / 承認待ちX件
- フィルター機能:
  - ステータスフィルター（全て/承認待ち/承認済み/却下/退会）
  - 拠点フィルター
- 検索機能（名前・フリガナ検索）
- アクション:
  - 新規生徒追加
  - 生徒詳細表示
  - 生徒情報編集
  - 拠点変更
  - 退会処理（理由記入可能）
  - 再入会処理
  - 申請の承認・却下・再審査

**コーチタブの機能:**
- コーチ一覧表示
- サブタイトル表示: アクティブX名
- フィルター機能:
  - ステータスフィルター（アクティブ/非アクティブ）
- 検索機能
- アクション:
  - コーチ招待
  - コーチ詳細表示
  - 担当拠点割当
  - 担当プログラム割当
  - コーチ情報編集
  - コーチ削除
  - アクティブ/非アクティブ切り替え

**新規生徒登録:**

**入力項目:**
- 名前、生年月日、学年
- 保護者情報（名前、メール、電話）
- 緊急連絡先情報
- 拠点選択
- 施設モード選択（FIXED/FREE）
- プログラム・セッションパターン選択
- 料金プラン選択

### 5.3 コーチ管理

**機能:**
- コーチの招待・編集・削除
- 担当施設の割り当て（複数選択可）
- 担当プログラムの割り当て（複数選択可）
- アクティブ/非アクティブ切り替え

**コーチ招待処理:**
1. Firebase Authenticationでアカウント作成
2. 招待メール送信（仮パスワード付き）
3. Member（type=coach）を作成
4. 担当拠点・プログラムを設定

### 5.4 レッスン担当設定

**機能:**
- カレンダーベースのレッスン表示
- 月間表示・週間表示・2週間表示の切り替え
- 日付選択による該当日のセッション一覧表示
- セッションごとの担当コーチ管理:
  - 担当コーチ確認・追加・削除
  - シフト登録済みコーチ（推奨）の表示
  - 他のコーチを選択する機能
  - アサインメントタイプ設定（専属/ヘルプ等）
- セッション定員と予約状況表示
- 担当未設定セッション数をカレンダーにマーカー表示
- 拠点フィルター機能

**表示情報:**
- セッション名（プログラム名 + 時間）
- 拠点名
- 予約状況（X名 / 定員Y名）
- 担当コーチ一覧（アイコン表示）
- 担当未設定の場合は警告表示

### 5.5 拠点管理

**機能:**
- 拠点一覧表示
- サブタイトル表示: アクティブX拠点
- フィルター機能:
  - ステータスフィルター（アクティブ/非アクティブ）
- アクション:
  - 拠点追加（FABボタン）
  - 拠点詳細表示
  - 拠点情報編集
  - 拠点削除
  - アクティブ/非アクティブ切り替え

**拠点追加・編集:**

**入力項目:**
- 拠点名（例: 東京本校）
- 住所
- 電話番号
- GPS機能の有効/無効
- GPS座標（緯度・経度）
- GPS許容半径（メートル）
- 営業時間設定
- アクティブ状態

**拠点詳細:**
- 基本情報表示
- 所属プログラム数
- 所属生徒数
- 担当コーチ数

### 5.6 クラス・プログラム管理

**構造:**
```
Program（プログラム）
  ↓ 所属する
Subject（種目・教科）
  ↓ 実施する場所
Classroom（教室）
  ↓ スケジュールテンプレート
SessionPattern（曜日・時間）
  ↓ 実際のインスタンス
Session（特定日のクラス）
```

**機能:**
- プログラムの作成・編集・削除
- CSVインポート機能（一括登録）
- ステータスフィルター（アクティブ/非アクティブ）
- 検索機能
- 料金プラン管理（複数段階料金対応）

**プログラム追加・編集:**

**入力項目:**
- プログラム名（例: 幼児体操クラス）
- 説明
- サブジェクト選択
- チケット価格
- デフォルト定員・実施時間
- 対象年齢（Min-Max）
- レベル（beginner / intermediate / advanced）
- 料金プラン設定（複数段階対応）
- アクティブ/非アクティブ切り替え

### 5.7 設定

**ユーザー情報カード:**
- 管理者プロフィール画像
- 名前・メールアドレス表示
- 管理者ロールバッジ
- ログアウトボタン

**設定メニュー（3行グリッド形式）:**

**1行目（組織・プラン・決済）:**
- 組織情報 - 組織名、業種、住所、電話番号の編集
- プラン・利用状況 - 契約プラン確認、利用制限（生徒数、コーチ数）確認
- 決済設定 - Stripe Connect連携、請求オプション、請求スケジュール

**2行目（アカウント・振替・シフト期限）:**
- アカウント・セキュリティ - 名前、電話番号、メール変更、パスワード変更、2要素認証
- 振替設定 - 振替レッスン設定（月間振替回数上限、振替期限、同じプログラムのみ許可、拠点横断許可）
- シフト提出期限 - コーチシフト提出の締切設定（当月・翌月）

**3行目（資料室・その他）:**
- 資料室管理 - 資料の作成・編集・公開管理
- その他 - 通知設定、セキュリティ設定等

**バージョン情報:**
- アプリバージョン・デバイス情報の表示

**設定カテゴリ詳細:**

| カテゴリ | 設定項目 |
|---------|----------|
| 予約設定 | 予約可能期限、キャンセル可能期限 |
| 振替設定 | 月間振替回数上限、振替期限、同じプログラムのみ許可、拠点横断許可 |
| シフト設定 | シフト提出期限（当月・翌月） |
| 通知設定 | メール通知ON/OFF、通知種別選択 |
| セキュリティ | 2要素認証、パスワード変更 |
| 決済設定 | Stripe Connect連携、請求オプション |

---

## 6. 会員タイプとフロー

### 会員タイプ（membershipType）

会員（Member）には以下の2つの契約種別があります:

| 会員タイプ | 説明 | 利用シーン |
|-----------|------|------------|
| **FREE** | 月額制・都度予約（拠点自由） | 好きな拠点・時間で通いたい生徒 |
| **FIXED** | 月額制・固定スケジュール | 毎週決まった曜日に通う生徒 |

### セッションモード（Session.mode / SessionPattern.mode）

セッション（Session）とセッションパターン（SessionPattern）には以下の3つのモードがあります:

| モード | 説明 | 定員管理 |
|--------|------|----------|
| **FREE** | フリー会員専用セッション | capacity のみ |
| **FIXED** | 固定会員専用セッション | capacity のみ |
| **BOTH** | 混在セッション（フリー・固定の両方が予約可能） | fixedCapacity + freeCapacity を分離管理 |

**BOTHモードの動作:**
- mode="BOTH" のセッションでは、フリー会員と固定会員の両方が予約できます
- 定員は別々に管理されます:
  - `fixedCapacity` / `fixedReservedCount` - 固定会員用の枠
  - `freeCapacity` / `freeReservedCount` - フリー会員用の枠
- フリー会員はフリー枠のみ、固定会員は固定枠のみを予約できます

### 追加チケット（Pass）

月の契約回数を超えて受講したい場合に「追加チケット」を購入できます。

| 項目 | 説明 |
|------|------|
| 購入単位 | 1回券、5回券、10回券など |
| 有効期限 | 購入日から1年間（設定により異なる） |
| 利用方法 | 月間契約回数を使い切った後、自動的に消費 |

### 予約・振替の業務フロー

#### FREE会員の予約フロー

```
1. 保護者がログイン → スケジュール画面
2. 週間カレンダーでFREE枠のクラスを検索（どの拠点でもOK）
3. クラスをタップ → 詳細確認（時間、場所、残席）
4. 「予約する」ボタン → 月間残回数確認
5. Booking作成（originType: FREE_DIRECT）
6. 月間利用回数が1回増加（残回数がない場合はPass消費）
7. 予約完了通知
```

#### FIXED会員の振替フロー

```
1. 保護者が固定予約をタップ
2. 「振替する」ボタンをタップ
3. 振替可能な日時を検索・選択
4. 振替回数制限チェック（月2回まで等）
5. 元のBookingをキャンセル
6. 新しいBooking作成（originType: FIXED_TRANSFER）
7. 振替完了通知
```

---

## 7. テストアカウント

### 保護者アカウント

**山田太郎** (山田花子・次郎の保護者)
```
Email: yamada@example.com
Password: test1234
```
- 子供: 山田花子（FREE会員）、山田次郎（FIXED会員）

**佐藤花子** (佐藤美香の保護者)
```
Email: sato@example.com
Password: test1234
```
- 子供: 佐藤美香（BOTH会員）

### コーチアカウント

**田中健太** (コーチ)
```
Email: tanaka@ponyclub.com
Password: test1234
```
- 担当施設: 東京本校

### 管理者アカウント

**鈴木一郎** (管理者)
```
Email: suzuki@ponyclub.com
Password: test1234
```
- 管理: 全施設（東京本校、富山高岡校）

---

## 8. 利用者ガイド

本章では、保護者・コーチ・管理者それぞれの立場でアプリを利用する際の基本操作を説明します。

---

### 8.1 保護者向けガイド

#### ログイン方法

1. アプリを起動
2. 登録済みのメールアドレスとパスワードを入力
3. 「ログイン」ボタンをタップ
4. 初回ログイン時はパスワード変更を推奨

#### ホーム画面の見方

| 項目 | 説明 |
|------|------|
| 施設切り替えメニュー | 複数拠点を利用している場合、左上のメニューから施設を切り替えできます |
| フィルターボタン | 日付範囲や連絡種別でフィードを絞り込めます |
| ブックマークボタン | お気に入りに登録した項目のみを表示できます |
| 月次施設選択カード | 翌月の施設選択状況を確認できます |
| フィードタイムライン | お知らせ、連絡帳、活動記録、出欠連絡、アンケート、アルバム、請求情報、承認連絡が時系列で表示されます |

#### 予約の仕方

**FREE会員（月額制・拠点自由）の場合:**

1. 下部メニューから「予約」をタップ
2. 週間カレンダーから希望の日時を選択（どの拠点でもOK）
3. 空きのあるクラスをタップ
4. 内容を確認し「予約する」をタップ
5. 月間回数が1回消費され、予約完了

**FIXED会員（月額制・固定スケジュール）の場合:**

- 固定スケジュールは自動的に青色で表示されます
- 追加の予約操作は不要です

#### 追加チケットの購入・利用

月の契約回数を使い切った場合、追加チケットを購入して受講できます。

1. 「設定」または「予約」画面から「チケット購入」をタップ
2. 購入する回数券を選択
3. 購入完了後、予約時に自動的に消費されます

**注意事項:**
- チケットには有効期限があります
- 残回数は「設定」画面で確認できます

#### 振替申請の手順

1. 「予約」画面で振替したい予約をタップ
2. 「振替する」ボタンをタップ
3. 振替可能な日時が一覧表示されます
4. 希望の日時を選択
5. 「振替を確定」をタップ

**注意事項:**
- 振替は月2回まで（設定により異なる場合あり）
- 振替期限を過ぎると振替不可
- 同じプログラム内での振替が基本

#### 活動記録の確認

1. 下部メニューから「活動記録」をタップ
2. 日付順に活動内容が表示されます
3. 写真・動画はスワイプで閲覧可能
4. コーチからのコメントも確認できます

#### 出席履歴の確認

1. 下部メニューから「出席」をタップ
2. カレンダービューで出席状況を確認
   - 緑: 出席
   - 赤: 欠席
   - 黄: 遅刻
   - オレンジ: 早退
3. 月間出席率がグラフで表示されます

#### お知らせの確認

1. 下部メニューから「お知らせ」をタップ
2. 通知タイプ別にアイコンが表示されます
   - 一般: 定期的なお知らせ
   - 重要: 緊急連絡（赤色表示）
   - イベント: イベント告知
   - スケジュール変更: 休講・時間変更など

#### 資料室の確認

1. 下部メニューから「その他」をタップ
2. 「資料室」を選択
3. 公開されている資料の一覧が表示されます
4. 未読の資料には「NEW」バッジが表示されます
5. 資料をタップして詳細を確認・添付ファイルをダウンロード

#### お子さまの追加

1. 「家族の設定」画面を開く
2. 「お子さまを追加」ボタンをタップ
3. 3ステップのウィザードに従って入力:
   - **Step 1: 基本情報** - お名前、生年月日、学年などを入力
   - **Step 2: プログラム選択** - プランタイプとプログラムを選択
   - **Step 3: 確認** - 入力内容を確認して追加

**注意事項:**
- 生年月日を入力すると学年が自動で設定されます
- 学年と生年月日に矛盾がある場合は警告が表示されます
- 最低1つのプログラムを選択する必要があります

#### 設定の変更

1. 下部メニューから「その他」をタップ
2. 「アプリの設定」を選択
3. 変更可能な項目:
   - 通知のON/OFF（プッシュ通知、メール通知、リマインダー）
   - プライバシー設定
   - 言語設定

---

### 8.2 コーチ向けガイド

#### ログイン方法

1. アプリを起動
2. 登録済みのメールアドレスとパスワードを入力
3. 「ログイン」ボタンをタップ
4. コーチ専用画面に自動遷移します

#### ホーム画面の見方

| 項目 | 説明 |
|------|------|
| ウェルカムメッセージ | 時間帯に応じた挨拶メッセージ |
| クイック統計 | 今日のセッション数、今週のセッション数、承認待ち出欠数 |
| 今日のスケジュール | 本日担当するクラスの一覧（予約人数付き） |
| 未承認の出欠 | 保護者からの出欠連絡で承認待ちのもの |
| プルリフレッシュ | 画面を下に引っ張って更新 |

#### 出欠確認の手順

1. 下部メニューから「出席管理」をタップ
2. 日付を選択（デフォルトは当日）
3. 担当クラスを選択
4. 予約済み生徒一覧が表示されます
5. 各生徒をタップして出欠を記録:
   - 出席（緑）
   - 欠席（赤）
   - 遅刻（黄）
   - 早退（オレンジ）
6. 必要に応じてメモを入力
7. 「保存」をタップ

**一括操作:**
- 「全員出席」ボタンで全員を出席に設定
- 「未確認のみ表示」で未記録の生徒のみ表示

#### 活動記録の作成

1. 下部メニューから「活動記録」をタップ
2. 「新規作成」ボタンをタップ
3. 入力項目:
   - 対象選択（施設全体/クラス/個別生徒）
   - 日付・時間
   - タイトル
   - 本文（活動内容を記載）
   - 写真・動画（最大10枚/3本）
   - タグ（マット運動、跳び箱など）
   - 公開設定
4. 「投稿」をタップ

#### お知らせの作成・配信

1. 下部メニューから「通知」をタップ
2. 「新規作成」ボタンをタップ
3. 入力項目:
   - 通知タイプ（一般/重要/イベント/スケジュール変更）
   - 対象選択（全体/施設/クラス/個別）
   - タイトル・本文
   - 画像添付（オプション）
4. 配信設定:
   - 即時配信: すぐに配信
   - 予約配信: 指定日時に配信
5. 「送信」をタップ

#### 昇級試験の実施

**試験の作成:**

1. 「試験管理」画面を開く
2. 「新規試験作成」をタップ
3. 入力項目:
   - 試験日
   - 対象クラス
   - 試験する級（例: リス級 → ネコ級）
   - 受験者を選択
4. 「作成」をタップ

**試験の実施・評価:**

1. 作成済みの試験を選択
2. 受験者を1人ずつ評価:
   - 評価項目をチェック（合格/不合格/要練習）
   - 写真・動画を撮影（証拠として保存）
   - フィードバックコメントを入力
3. 総合判定（合格/不合格）を選択
4. 「評価を確定」をタップ
5. 合格の場合、生徒のランクが自動更新されます

---

### 8.3 管理者向けガイド

#### ログイン方法

1. アプリを起動
2. 管理者アカウントでログイン
3. 管理者ダッシュボードに自動遷移します

#### ダッシュボードの見方

| 項目 | 説明 |
|------|------|
| 在籍生徒数 | 現在の総生徒数と推移グラフ |
| 稼働率 | クラスの予約率 |
| 未対応タスク | 対応が必要な項目一覧 |
| 今週のスケジュール | 全施設のクラス予定 |

#### 新規生徒の登録

1. 「会員管理」画面を開く
2. 「生徒を追加」ボタンをタップ
3. 基本情報を入力:
   - 名前、フリガナ
   - 生年月日、性別
4. 会員設定:
   - 会員種別（FREE/FIXED/BOTH）
   - メイン施設
   - メインプログラム
5. 保護者情報:
   - 既存の保護者を選択、または
   - 新規保護者を登録
6. 「登録」をタップ

**FIXED会員の場合の追加設定:**
- 固定スケジュール（曜日・時間）の設定
- 月間回数の設定

#### コーチの招待

1. 「コーチ管理」画面を開く
2. 「コーチを招待」ボタンをタップ
3. 入力項目:
   - 名前
   - メールアドレス
   - 担当施設（複数選択可）
4. 「招待を送信」をタップ
5. コーチに招待メールが送信されます
6. コーチは招待メールからパスワードを設定してログイン

#### 施設・クラスの設定

**施設の追加:**

1. 「施設管理」画面を開く
2. 「施設を追加」ボタンをタップ
3. 入力項目:
   - 施設名（例: 東京本校）
   - 住所、電話番号
   - 施設モード
4. 「登録」をタップ

**クラス（プログラム）の設定:**

1. 「クラス管理」画面を開く
2. 「プログラムを追加」ボタンをタップ
3. 入力項目:
   - プログラム名（例: 幼児体操クラス）
   - 種目
   - 対象年齢
   - レベル
4. スケジュールパターンを設定:
   - 曜日・開始時間・終了時間
   - 定員
   - モード（FREE/FIXED/BOTH）
5. 「登録」をタップ

#### 各種設定の変更

1. 「設定」画面を開く
2. 変更可能な項目:

| 設定カテゴリ | 設定項目 |
|-------------|----------|
| 予約設定 | 予約可能期限（何日前まで予約可能か） |
| | キャンセル可能期限（何時間前までキャンセル可能か） |
| 振替設定 | 月間振替回数上限 |
| | 振替期限 |
| | 同じプログラムのみ許可 |
| | 拠点横断許可 |
| 通知設定 | プッシュ通知ON/OFF |
| | 通知タイミング |
| 組織設定 | 組織名・ロゴの変更 |

3. 変更後「保存」をタップ

---

## 9. よくある質問（FAQ）

### 保護者向け

**Q: パスワードを忘れました**
A: ログイン画面の「パスワードを忘れた方」をタップし、登録メールアドレスを入力してください。リセット用メールが届きます。

**Q: お子さまを追加したい**
A: 「その他」→「家族の設定」→「お子さまを追加」をタップしてください。3ステップのウィザードに従って、基本情報とプログラムを入力します。

**Q: 振替ができません**
A: 以下を確認してください:
- 月間振替回数の上限に達していないか
- 振替期限を過ぎていないか
- 振替先のクラスに空きがあるか

**Q: 月の回数を使い切りました**
A: 追加チケットを購入することで、契約回数を超えて受講できます。「設定」画面から購入できます。

**Q: 追加チケットの残回数を確認したい**
A: 「設定」画面の「チケット情報」から確認できます。

**Q: 資料室の資料が見つからない**
A: 以下を確認してください:
- 資料が公開済みかどうか（管理者に確認）
- 正しい施設を選択しているか（複数施設利用時）
- 資料の公開期間内かどうか

**Q: お子さまの情報を編集したい**
A: 「家族の設定」からお子さまを選択し、詳細画面で編集できます。プログラムや契約の変更は管理者への承認申請が必要な場合があります。

### コーチ向け

**Q: 担当クラスが表示されません**
A: 管理者に担当施設の割り当てを確認してください。

**Q: 出欠を間違えて保存しました**
A: 同じ画面から再度出欠を変更して保存してください。

**Q: シフトが登録できません**
A: 以下を確認してください:
- シフト提出期限を過ぎていないか
- 期限内の月を表示しているか
- 必要な情報（拠点・日付）が入力されているか

**Q: 勤怠の打刻ができません**
A: 以下を確認してください:
- GPS対応拠点の場合、位置情報権限が許可されているか
- 本日のシフトが登録されているか
- ネットワークに接続されているか

### 管理者向け

**Q: 生徒の会員種別を変更したい**
A: 会員管理画面から該当生徒を選択し、「編集」から会員種別を変更してください。

**Q: コーチの担当施設を変更したい**
A: コーチ管理画面から該当コーチを選択し、「編集」から担当施設を変更してください。

---

*このドキュメントはテスト実施用に作成されました。*
*最終更新: 2025年12月19日*
